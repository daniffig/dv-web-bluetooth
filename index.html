<html>
  <head>

  </head>
  <body>
    <a href="#" onClick="useBluetooth()">Web Bluetooth</a>

    <script type="text/javascript">
      const useBluetooth = function () {
        console.log('starting...');

        console.log(navigator.bluetooth);

        // Step 1: Scan for a device with 0xffe5 service
        navigator.bluetooth.requestDevice({
          // filters: [{ services: [0xffe5] }],
          acceptAllDevices: true,
          optionalServices: [0xffe5, 'user_data']
        })
        .then(function(device) {
          console.log('device');
          // Step 2: Connect to it
          return device.gatt.connect();
        })
        .then(function(server) {
          console.log('server');
          console.log(server);
          // console.log(server.getPrimaryServices());
          // Step 3: Get the Service
          // return server.getPrimaryService('0xffe5');
          return server.getPrimaryServices();
          // return server.getPrimaryService('user_data');
        })
        .then(function(service) {
          console.log('service');
          console.log(service);
          // Step 4: get the Characteristic
          return service.getCharacteristic(0xffe9);
        })
        .then(function(characteristic) {
          console.log('characteristic');
          // Step 5: Write to the characteristic
          var data = new Uint8Array([0xbb, 0x25, 0x05, 0x44]);
          return characteristic.writeValue(data);
        })
        .catch(function(error) {
          // And of course: error handling!
          console.error('Connection failed!', error);
        });

        // console.log('finished!');
      }
    </script>
  </body>
</html>
